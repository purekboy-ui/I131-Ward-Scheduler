# I-131 系統 DEMO 版本與 GitHub 原始規格差異說明

## 一、 主要功能新增與規格調整

### 1. 獨立的「訂藥管理」模組與結構化欄位 (重大資料表變更)
- **GitHub 原版**：排床的特殊需求（例如：錠劑/水劑、是否打 Thyrogen）可能依賴自由格式的「備註欄」。
- **DEMO 新增**：
  - 取消備註欄，改為結構化欄位：`medType` (錠劑/水劑)、`thyrogen` (Boolean)、`medOrdered` (Boolean 訂藥狀態)。
  - 新增專屬的「訂藥管理」頁面，藥師可在此清單中一鍵切換「已訂藥/未訂藥」狀態。
  - 新增了列表的 **列印/PDF** 與 **匯出 Excel/CSV** 功能，供藥師印出配藥單。

### 2. 「小劑量預約」邏輯抽離與檢視整合
- **GitHub 原版**：無小劑量患者 (<30mCi) 預約功能。(不需住院，但要提前訂藥，病人當天來核醫科服藥)
- **DEMO 新增**：
  - 小劑量預約走獨立的新增 Modal，**不選床位**。
  - **防呆卡控**：日期僅允許選 週一、週三、週四，且劑量不可大於等於 30mCi。
  - **畫面整合**：排程月曆上，小劑量患者會以「漂浮標籤 (Badge)」的形式顯示在對應日期上，不佔用 5B/6B 病床格子，醫護人員可一眼綜觀住院與門診的業務總量。

### 3. 加入嚴格的防呆與防護鎖定 (業務邏輯卡控)
- **GitHub 原版**：無特定的時間防護，人員可能誤改或刪除過去的紀錄，或在病患即將入住前拔除排程。(嚴重影響核醫業務，例如：藥訂好了，卻臨時取消或改劑量)
- **DEMO 新增**：
  - **21 天鎖定防呆**：若距離入住日期不足 21 天，一般 `user` 無法新增、編輯或刪除該日期的排程。
  - **歷史紀錄防寫**：一般人員絕對無法修改過去日期的預約。
  - **管理員例外**：只有 `admin` 可以無視 21 天與過去日期的限制進行強制作業，但只要動到歷史紀錄，會強制在 Log 中打上 `【歷史】` 標籤。

### 4. 操作日誌系統 (Audit Logs)
- **GitHub 原版**：無特別強調使用者行為追蹤。
- **DEMO 新增**：
  - 在「月曆排程」頁面下方新增了「操作紀錄」區塊。
  - 系統後端必須記錄所有 Create, Update, Delete 行為。記錄內容需包含：操作者帳號、動作對象、修改了什麼參數（例如劑量 20 -> 30mCi）、以及操作時間。這對於釐清醫療排床爭議非常重要。

### 5. 各列表視圖新增「日期區間檢索」與「月結匯出」
- **GitHub 原版**：僅有基礎列表與文字搜查。
- **DEMO 新增**：
  - 「預約管理」與「訂藥管理」皆追加了「起始~結束日期」的時間段篩選邏輯。
  - 報表中心新增「一鍵下載月結報表」，將當月 5B/6B 所有住院資料匯出為 CSV。

---

## 二、 使用者權限 (Role-Based Access Control) 分配定義

為了避免醫療爭議，我們明確制定了三種角色權限系統，請在 API 與前端路由實作以下權限隔離：

1. **一般使用者 (`user`)**：
   - **定位**：臨床醫師及個管師。
   - **權限**：可看月曆，只能新增/編輯/刪除 **「自己建立」** 且 **「大於 21 天」** 的預約。
   - **限制**：無法看到「訂藥管理」與「操作日誌」頁面。

2. **藥師 (`pharmacist`)**：
   - **定位**：核子醫學科專責訂藥人員。
   - **權限**：具有「訂藥管理」的最高操作權，可點擊變更「確認訂藥」，也可匯出清單。
   - **限制**：為了醫療責任歸屬，藥師**不可新增排程，且「劑量」、「床位」等欄位對藥師全部鎖死為唯讀 (Read-only)**。

3. **管理員 (`admin`)**：
   - **定位**：核子醫學科管理排程人員、伺服器系統管理員。
   - **權限**：系統內最高權限。可無視 21 天鎖定與歷史限制，可編輯或刪除任何人的排程，也能進入「訂藥管理」與「操作紀錄」追蹤全域狀況。
