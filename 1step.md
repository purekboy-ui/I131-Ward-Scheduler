# **軟體規格說明書：碘131隔離病房排程管理系統**

## **1\. 系統概述 (System Overview)**

本系統旨在協助核醫科有效管理碘131隔離病房（5B、6B）之病人入住排程、劑量管理及報表產出。系統需具備邏輯判斷能力以自動過濾不可預約之日期，並提供權限分級以確保資料安全與排程彈性。

## **2\. 使用者角色與權限 (User Roles & Permissions)**

系統分為兩種角色，對應需求點 **(5)**：

### **2.1 一般使用者 (General User)**

* **對象：** 臨床科別醫師及個管師。  
* **權限：**  
  * **查詢 (Read):** 可檢視月曆上的排程狀況。  
  * **預約 (Booking):** 可針對「開放中」且「空床」的時段進行預約 (Booking)。  
  * **CRUD操作:** 僅限於修改或刪除自己建立的預約。

### **2.2 系統管理員 (Administrator)**

* **對象：** 核醫科護理人員或排程總負責人。  
* **權限：**  
  * 擁有一般使用者的所有功能。  
  * **帳號管理:** 新增、修改、停用一般使用者帳號。  
  * **床位/排程例外管理:** 可手動開啟/關閉特定日期的床位（無視預設規則）。  
  * **強制操作:** 可修改或刪除任何人的預約紀錄。

## **3\. 功能需求詳細說明 (Functional Requirements)**

### **3.1 登入模組 (Login Interface)** 

* 系統須提供安全登入介面。  
* 欄位：帳號、密碼。  
* 驗證成功後，依據角色導向至對應的操作主畫面。

### **3.2 排程月曆主介面 (Calendar Dashboard)** 

* **視覺呈現：** 以「月曆」形式顯示，可切換月份。  
* **床位顯示：** 每日需分割顯示「5B」與「6B」兩床狀況。  
* **狀態標示：**  
  * 空白/灰色：不可預約 (非週二/五或國定假日)。  
  * 綠色：可預約 (空床)。  
  * 紅色/藍色：已預約 (Occupied)。  
* **資訊顯示卡 (Booking Card)：**  
  * 當床位已被預約時，月曆上需直接顯示：  
    * 病人姓名、住哪一床  
    * 病歷號 (Chart No.)  
    * 服用劑量 I-131 (mCi)  
    * 主治醫師

### **3.3 預約與病患管理 (Booking & CRUD)** 

* **新增 (Create):** 點擊空床位跳出預約視窗，需輸入：病人基本資料、預計劑量、主治醫師等。  
* **修改 (Update):** 修改劑量、病人基本資訊或調整日期。  
* **刪除 (Delete):** 取消預約，釋出床位。  
* **查詢 (Read):** 可透過病歷號、姓名、主治醫師或日期搜尋歷史入住紀錄。

### **3.4 智慧排床邏輯 (Scheduling Logic / Rules)** 

系統後端需包含一套驗證邏輯 (Validation Rule)，在使用者嘗試 Booking 時運作：

1. **床位限制：** 系統僅有 5B、6B 兩個物件，同一日期、同一床位 ID 只能有一筆有效訂單 (Unique Constraint)。  
2. **預設開放規則：**  
   * 僅允許 **每週二** 與 **每週五** 為入住起始日。  
3. **假日過濾：**  
   * 系統需內建或匯入年度「國定假日表」。  
   * 若週二/週五撞期國定假日，系統自動將該日鎖定為「不可預約」。  
4. **管理員彈性覆寫 (Admin Override)：**  
   * 管理員擁有「排程設定功能」，可針對特定日期（例如：想加開週三，或是國定假日需緊急治療）手動將床位狀態改為「Open」。  
   * 一般使用者即可針對這些被手動開啟的日期進行 Booking。

### **3.5 報表輸出 (Reporting)** 

* **篩選條件：** 依日期範圍 (起\~迄)、依醫師、依劑量範圍。  
* **輸出格式：** 支援 Excel (.xlsx) 或 PDF。  
* **報表內容範例：**  
  * 月度入住統計表。  
  * 碘131劑量統計表 (供輻防申報使用)。  
  * 病患排程清單。

### **3.6 系統稽核紀錄 (Audit Logs)** 

* 系統背景需自動記錄所有「寫入、修改、刪除」的動作。  
* **Log 欄位內容：**  
  * **Who:** 操作者帳號 (User ID)。  
  * **When:** 操作時間戳記 (Timestamp, 精確至分)。  
  * **What:** 動作類型 (新增預約、取消預約、修改劑量)。  
  * **Target:** 影響的對象 (床位號、預約日期、病人病歷號)。  
  * **Detail:** (選填) 修改前後的值 (例如：劑量從 100mCi 改為 150mCi)。

## **4\. 資料庫欄位規劃建議 (Database Schema Suggestion)**

為了滿足上述功能，核心資料表 (Table) 建議如下：

**1\. Users (使用者)**

* UserID, Username, PasswordHash, Role (Admin/User), IsActive

**2\. Beds (床位設定 \- 用於管理彈性規則)**

* Date (日期), BedID (5B/6B), Status (Open/Closed/Maintenance), IsAdminOverride (是否為管理員手動開啟)

**3\. Bookings (預約紀錄)**

* BookingID, Date, BedID (5B/6B), ChartNo (病歷號), PatientName, Dosage\_mCi, DoctorName, CreatedBy, CreatedAt, UpdatedAt

**4\. AuditLogs (稽核紀錄)**

* LogID, UserID, ActionType, TargetTable, TargetID, OldValue, NewValue, Timestamp

