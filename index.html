<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碘131隔離病房排程管理系統 | I-131 Scheduling</title>
    <meta name="description" content="核醫科碘131隔離病房智慧排程管理系統，支援5B/6B床位管理、預約排程與報表輸出">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-icon">
                <svg viewBox="0 0 100 100" class="atom-icon">
                    <circle cx="50" cy="50" r="8" fill="currentColor" />
                    <ellipse cx="50" cy="50" rx="45" ry="15" fill="none" stroke="currentColor" stroke-width="2"
                        class="orbit orbit-1" />
                    <ellipse cx="50" cy="50" rx="45" ry="15" fill="none" stroke="currentColor" stroke-width="2"
                        class="orbit orbit-2" />
                    <ellipse cx="50" cy="50" rx="45" ry="15" fill="none" stroke="currentColor" stroke-width="2"
                        class="orbit orbit-3" />
                </svg>
            </div>
            <h2>I-131 Ward Scheduler</h2>
            <div class="loading-bar"><span></span></div>
        </div>
    </div>

    <!-- Login Page - Single Column -->
    <div id="login-page" class="page login-page" style="display: none;">
        <div class="login-container-centered">
            <div class="login-card">
                <div class="login-logo">
                    <span class="logo-emoji"><svg viewBox="-2 -2 28 28" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="56" height="56"
                            style="color:var(--primary);">
                            <circle cx="12" cy="12" r="1"></circle>
                            <path
                                d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z">
                            </path>
                            <path
                                d="M15.7 3.8c-2.04-2.03-7.36-.02-11.9 4.5-4.54 4.52-6.54 9.87-4.5 11.9 2.04 2.03 7.36.02 11.9-4.5 4.54-4.52 6.54-9.87 4.5-11.9Z">
                            </path>
                        </svg></span>
                </div>
                <div class="login-header">
                    <h2>歡迎登入碘131病房排程系統</h2>
                    <p>請輸入您的帳號密碼</p>
                </div>
                <form id="login-form" class="login-form">
                    <div class="input-group">
                        <label for="username">帳號</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg>
                            <input type="text" id="username" placeholder="請輸入帳號" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="password">密碼</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                            <input type="password" id="password" placeholder="請輸入密碼" required>
                        </div>
                    </div>
                    <div class="login-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="remember">
                            <span class="checkmark"></span>
                            記住我
                        </label>
                    </div>
                    <button type="submit" class="btn-primary btn-login">
                        <span>登入系統</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7" />
                        </svg>
                    </button>
                </form>
                <div class="demo-hint">
                    <p>DEMO 帳號：</p>
                    <code>admin / admin</code> 或 <code>user / user</code> 或 <code>phar / phar</code>（藥師）
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="page dashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon"><svg viewBox="-2 -2 28 28" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="32" height="32"
                            style="color:var(--primary);">
                            <circle cx="12" cy="12" r="1"></circle>
                            <path
                                d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z">
                            </path>
                            <path
                                d="M15.7 3.8c-2.04-2.03-7.36-.02-11.9 4.5-4.54 4.52-6.54 9.87-4.5 11.9 2.04 2.03 7.36.02 11.9-4.5 4.54-4.52 6.54-9.87 4.5-11.9Z">
                            </path>
                        </svg></span>
                    <span class="logo-text">I-131 Ward</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="calendar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <span>排程月曆</span>
                </a>
                <a href="#" class="nav-item" data-page="bookings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                    </svg>
                    <span>預約管理</span>
                </a>
                <a href="#" class="nav-item pharmacist-only" data-page="medication" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.5 20.5l-6-6a4.243 4.243 0 0 1 6-6l6 6a4.243 4.243 0 0 1-6 6z" />
                        <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
                    </svg>
                    <span>訂藥管理</span>
                </a>
                <a href="#" class="nav-item admin-only" data-page="reports">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.21 15.89A10 10 0 1 1 8 2.83" />
                        <path d="M22 12A10 10 0 0 0 12 2v10z" />
                    </svg>
                    <span>報表中心</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="#" class="nav-item admin-only" data-page="admin" style="margin-bottom:12px;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3" />
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                    </svg>
                    <span>系統後台</span>
                </a>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div class="user-details">
                        <span class="user-name" id="user-name">Admin</span>
                        <span class="user-role" id="user-role">系統管理員</span>
                    </div>
                </div>
                <button class="btn-logout" id="logout-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div class="header-left">
                    <button class="btn-menu" id="menu-toggle">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12" />
                            <line x1="3" y1="6" x2="21" y2="6" />
                            <line x1="3" y1="18" x2="21" y2="18" />
                        </svg>
                    </button>
                    <h1 class="page-title" id="page-title">排程月曆</h1>
                </div>
                <div class="header-right">
                    <div class="header-stats">
                        <div class="stat-item">
                            <span class="stat-label">今日預約</span>
                            <span class="stat-value" id="today-bookings">2</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">本月總計</span>
                            <span class="stat-value" id="month-bookings">18</span>
                        </div>
                    </div>
                    <div class="header-date" id="header-date"></div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Calendar Page -->
                <section id="calendar-page" class="content-page active">
                    <!-- Upcoming Available Slots -->
                    <div class="upcoming-slots">
                        <h3>🗓️ 最近可預約時段</h3>
                        <div class="slots-list" id="upcoming-slots-list">
                            <!-- Generated by JS -->
                        </div>
                    </div>

                    <div
                        style="background:var(--bg-secondary); border-left:4px solid var(--accent); padding:10px 16px; margin-bottom:16px; border-radius:4px; font-size:0.9rem; color:var(--text-secondary); line-height:1.5;">
                        <strong>💡 操作提示：</strong><br>
                        1. 點擊「空床」可直接進入新增住床預約介面（含小劑量門診預約）。<br>
                        2. 點擊「已預約病患卡片」可開啟編輯選單，支援右鍵快捷刪除或編輯。<br>
                        3. 【鎖定保護】若距離入住不到 21 天，該床位將受保護，將無法被非管理員新增、修改或刪除。
                    </div>

                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="btn-icon" id="prev-month">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6" />
                                </svg>
                            </button>
                            <h2 class="calendar-title" id="calendar-title">2026年 1月</h2>
                            <button class="btn-icon" id="next-month">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6" />
                                </svg>
                            </button>
                        </div>
                        <div class="calendar-actions">
                            <button class="btn-today" id="today-btn">今天</button>
                        </div>
                    </div>
                    <div class="calendar-legend">
                        <div class="legend-item"><span class="legend-color available"></span>可預約</div>
                        <div class="legend-item"><span class="legend-color occupied-5b"></span>5B 已預約</div>
                        <div class="legend-item"><span class="legend-color occupied-6b"></span>6B 已預約</div>
                        <div class="legend-item"><span class="legend-color closed"></span>不可預約</div>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-weekdays">
                            <div class="weekday">週日</div>
                            <div class="weekday">週一</div>
                            <div class="weekday highlight">週二</div>
                            <div class="weekday">週三</div>
                            <div class="weekday">週四</div>
                            <div class="weekday highlight">週五</div>
                            <div class="weekday">週六</div>
                        </div>
                        <div class="calendar-days" id="calendar-days">
                            <!-- Calendar days will be generated by JS -->
                        </div>
                    </div>

                    <!-- Audit Logs Section (inside calendar page) -->
                    <div class="audit-section">
                        <div class="audit-header">
                            <h3>📝 操作紀錄</h3>
                            <div class="audit-filters">
                                <input type="date" id="log-start-date" title="起始日期">
                                <span>至</span>
                                <input type="date" id="log-end-date" title="結束日期">
                                <button class="btn-outline btn-search-log" id="search-logs-btn">查詢</button>
                                <button class="btn-outline btn-reset-log" id="reset-logs-btn">重置</button>
                            </div>
                        </div>
                        <div class="audit-list" id="audit-list">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </section>

                <section id="bookings-page" class="content-page">
                    <div
                        style="background:var(--bg-secondary); border-left:4px solid var(--primary); padding:10px 16px; margin-bottom:16px; border-radius:4px; font-size:0.9rem; color:var(--text-secondary); line-height:1.5;">
                        <strong>💡 操作提示：</strong> 在這裡可快速搜尋所有歷史或未來預約，可透過右上角的日期區間精準設定過濾條件。若想看到小劑量患者，請勾選「包含小劑量預約」。
                    </div>
                    <div class="bookings-header">
                        <div class="search-bar">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                            </svg>
                            <input type="text" id="search-input" placeholder="搜尋病歷號、姓名、主治醫師...">
                        </div>
                        <div class="booking-date-filter"
                            style="display:flex;align-items:center;gap:8px;margin-top:8px;flex-wrap:wrap;">
                            <input type="date" id="booking-filter-start" title="起始日期"
                                style="padding:6px 10px;border:1px solid var(--border);border-radius:8px;font-size:0.85rem;">
                            <span style="color:var(--text-muted);">至</span>
                            <input type="date" id="booking-filter-end" title="結束日期"
                                style="padding:6px 10px;border:1px solid var(--border);border-radius:8px;font-size:0.85rem;">
                            <button class="btn-outline" id="booking-filter-btn"
                                style="padding:6px 12px;font-size:0.85rem;">篩選</button>
                            <button class="btn-outline" id="booking-filter-reset"
                                style="padding:6px 12px;font-size:0.85rem;">重置</button>
                            <label class="checkbox-label" style="margin-left:8px;">
                                <input type="checkbox" id="booking-include-op">
                                <span class="checkmark"></span>
                                包含小劑量預約
                            </label>
                        </div>
                    </div>
                    <div class="bookings-table-wrapper">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>日期</th>
                                    <th>類型</th>
                                    <th>病歷號</th>
                                    <th>病患姓名</th>
                                    <th>醫令劑量</th>
                                    <th>劑型</th>
                                    <th>Thyrogen</th>
                                    <th>訂藥</th>
                                    <th>主治醫師</th>
                                    <th>預約者</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-tbody">
                                <!-- Bookings will be generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Medication Management Page (Admin/MedAdmin Only) -->
                <section id="medication-page" class="content-page">
                    <div
                        style="background:var(--bg-secondary); border-left:4px solid var(--bed-5b); padding:10px 16px; margin-bottom:16px; border-radius:4px; font-size:0.9rem; color:var(--text-secondary); line-height:1.5;">
                        <strong>💡 操作提示：</strong><br>
                        本頁面供藥師與管理員追蹤住院病患的碘 131 備藥進度。您可以直接在此調整「劑量與劑型」，並點擊按鈕變更「訂藥狀態」。確認配藥完畢後，請利用右側的「匯出
                        Excel」或「列印」功能，輸出完整病患交班表。
                    </div>
                    <div class="medication-header">
                        <div class="search-bar">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                            </svg>
                            <input type="text" id="med-search-input" placeholder="搜尋病患或病歷號...">
                        </div>
                        <div class="med-filters"
                            style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-top:8px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="med-filter-unorder" checked>
                                <span class="checkmark"></span>
                                只顯示未訂藥
                            </label>
                            <div style="display:flex;align-items:center;gap:6px;flex-wrap:wrap;">
                                <input type="date" id="med-filter-start" title="起始日期"
                                    style="padding:5px 8px;border:1px solid var(--border);border-radius:8px;font-size:0.85rem;">
                                <span style="color:var(--text-muted);">至</span>
                                <input type="date" id="med-filter-end" title="結束日期"
                                    style="padding:5px 8px;border:1px solid var(--border);border-radius:8px;font-size:0.85rem;">
                            </div>
                            <div style="display:flex;gap:4px;">
                                <button class="btn-outline med-quick-filter" data-days="7"
                                    style="padding:4px 10px;font-size:0.8rem;">7天內</button>
                                <button class="btn-outline med-quick-filter" data-days="14"
                                    style="padding:4px 10px;font-size:0.8rem;">14天內</button>
                                <button class="btn-outline med-quick-filter" data-days="30"
                                    style="padding:4px 10px;font-size:0.8rem;">1個月</button>
                                <button class="btn-outline" id="med-filter-reset"
                                    style="padding:4px 10px;font-size:0.8rem;">全部</button>
                            </div>
                            <div style="display:flex;gap:6px;margin-left:auto;">
                                <button class="btn-outline" id="med-print-btn"
                                    style="padding:4px 10px;font-size:0.8rem;display:flex;align-items:center;gap:4px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        width="14" height="14">
                                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                                        <path
                                            d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2">
                                        </path>
                                        <rect x="6" y="14" width="12" height="8"></rect>
                                    </svg> 列印/PDF
                                </button>
                                <button class="btn-primary" id="med-export-excel-btn"
                                    style="padding:4px 10px;font-size:0.8rem;display:flex;align-items:center;gap:4px;">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        width="14" height="14">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg> 匯出Excel
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="bookings-table-wrapper">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>入住日期</th>
                                    <th>床位</th>
                                    <th>病患資訊</th>
                                    <th>劑量 / 劑型</th>
                                    <th>Thyrogen</th>
                                    <th>訂藥狀態</th>
                                </tr>
                            </thead>
                            <tbody id="medication-tbody">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Outpatient (Low Dose) Page -->
                <section id="outpatient-page" class="content-page">
                    <div
                        style="background:var(--bg-secondary); border-left:4px solid var(--warning); padding:10px 16px; margin-bottom:16px; border-radius:4px; font-size:0.9rem; color:var(--text-secondary); line-height:1.5;">
                        <strong>💡 操作提示：</strong><br>
                        專屬低於 30mCi 以下門診吃藥病患排程，無須選擇床位。系統強制規定給藥日僅限「週一、週三、週四」。小劑量預約將同步整合顯示於排程月曆當天。
                    </div>
                    <div class="outpatient-header">
                        <h3>小劑量預約 (限週一、三、四)</h3>
                        <button class="btn-primary" id="add-outpatient-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            新增門診給藥
                        </button>
                    </div>
                    <div class="bookings-table-wrapper">
                        <table class="bookings-table">
                            <thead>
                                <tr>
                                    <th>服用日期</th>
                                    <th>病歷號 / 姓名</th>
                                    <th>劑量 (mCi)</th>
                                    <th>劑型</th>
                                    <th>主治醫師</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="outpatient-tbody">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Reports Page -->
                <section id="reports-page" class="content-page">
                    <div class="reports-grid">
                        <div class="report-card">
                            <div class="report-icon">📊</div>
                            <h3>月度入住統計表</h3>
                            <p>依月份統計入住人數、床位使用率</p>
                            <div class="report-actions">
                                <button class="btn-outline">預覽</button>
                                <button class="btn-primary" id="extract-month-report">一鍵下載月結報表</button>
                            </div>
                        </div>
                        <div class="report-card">
                            <div class="report-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="40"
                                    height="40" style="color:var(--primary);">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <path
                                        d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z">
                                    </path>
                                    <path
                                        d="M15.7 3.8c-2.04-2.03-7.36-.02-11.9 4.5-4.54 4.52-6.54 9.87-4.5 11.9 2.04 2.03 7.36.02 11.9-4.5 4.54-4.52 6.54-9.87 4.5-11.9Z">
                                    </path>
                                </svg></div>
                            <h3>碘131劑量統計表</h3>
                            <p>輻防申報用劑量統計報表</p>
                            <div class="report-actions">
                                <button class="btn-outline">預覽</button>
                                <button class="btn-primary">下載 PDF</button>
                            </div>
                        </div>
                        <div class="report-card">
                            <div class="report-icon">📋</div>
                            <h3>病患排程清單</h3>
                            <p>依日期範圍輸出排程清單</p>
                            <div class="report-actions">
                                <button class="btn-outline">預覽</button>
                                <button class="btn-primary">下載 Excel</button>
                            </div>
                        </div>
                    </div>
                    <div class="report-filter">
                        <h3>篩選條件</h3>
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>日期範圍</label>
                                <div class="date-range">
                                    <input type="date" id="report-start">
                                    <span>至</span>
                                    <input type="date" id="report-end">
                                </div>
                            </div>
                            <div class="filter-group">
                                <label>主治醫師</label>
                                <input type="text" id="report-doctor" placeholder="輸入醫師名稱">
                            </div>
                            <div class="filter-group">
                                <label>劑量範圍 (mCi)</label>
                                <div class="range-inputs">
                                    <input type="number" placeholder="最小" id="dose-min">
                                    <span>-</span>
                                    <input type="number" placeholder="最大" id="dose-max">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Admin Page (User Management) -->
                <section id="admin-page" class="content-page">
                    <!-- 系統設定 -->
                    <div class="admin-header" style="margin-bottom:20px;">
                        <h3>⚙️ 系統設定</h3>
                    </div>
                    <div
                        style="display:flex;flex-direction:column;gap:12px;margin-bottom:24px;padding:16px;background:var(--bg-secondary);border-radius:12px;">
                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0; margin-bottom: 8px;">
                            防呆機制：設定距離實際入住日/給藥日前的天數。一旦低於設定天數，一般使用者將無法新增或修改對應的預約資料，需由管理員處理。
                        </p>
                        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                            <label style="font-weight:500;min-width:180px;">🏥 住院預約鎖定天數</label>
                            <input type="number" id="lock-days-inpatient" min="0" max="90"
                                style="width:70px;padding:6px 10px;border:1px solid var(--border);border-radius:8px;font-size:0.95rem;">
                            <span style="color:var(--text-muted);font-size:0.85rem;">天</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                            <label style="font-weight:500;min-width:180px;">💊 小劑量預約鎖定天數</label>
                            <input type="number" id="lock-days-outpatient" min="0" max="90"
                                style="width:70px;padding:6px 10px;border:1px solid var(--border);border-radius:8px;font-size:0.95rem;">
                            <span style="color:var(--text-muted);font-size:0.85rem;">天</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <button class="btn-primary" id="save-lock-days"
                                style="padding:6px 14px;font-size:0.85rem;">儲存鎖定設定</button>
                            <span id="lock-days-hint" style="color:var(--text-muted);font-size:0.85rem;"></span>
                        </div>
                    </div>

                    <!-- 使用者帳號管理 -->
                    <div class="admin-header">
                        <h3>使用者帳號管理</h3>
                        <button class="btn-primary" id="add-user-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                            新增使用者
                        </button>
                    </div>
                    <div class="admin-table-wrapper">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>帳號</th>
                                    <th>姓名</th>
                                    <th>角色</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Booking Modal -->
    <div id="booking-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">新增預約</h3>
                <button class="btn-close" id="modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <form id="booking-form" class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>入住日期</label>
                        <input type="date" id="booking-date" required>
                    </div>
                    <div class="form-group">
                        <label>床位選擇</label>
                        <div class="bed-selector">
                            <label class="bed-option">
                                <input type="radio" name="bed" value="5B" required>
                                <span class="bed-label">5B</span>
                            </label>
                            <label class="bed-option">
                                <input type="radio" name="bed" value="6B">
                                <span class="bed-label">6B</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>病歷號</label>
                        <input type="text" id="booking-chart" placeholder="例：A123456789" required>
                    </div>
                    <div class="form-group">
                        <label>病患姓名</label>
                        <input type="text" id="booking-name" placeholder="請輸入姓名" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>服用劑量 (mCi)</label>
                        <input type="number" id="booking-dose" placeholder="例：100" required>
                    </div>
                    <div class="form-group">
                        <label>主治醫師</label>
                        <input type="text" id="booking-doctor" placeholder="請輸入醫師名稱" required>
                    </div>
                </div>
                <!-- 新增：劑型與 Thyrogen -->
                <div class="form-row">
                    <div class="form-group">
                        <label>服用藥物劑型</label>
                        <select id="booking-med-type">
                            <option value="錠劑">錠劑</option>
                            <option value="水劑">水劑</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>是否使用 Thyrogen</label>
                        <select id="booking-thyrogen">
                            <option value="false">否</option>
                            <option value="true">是</option>
                        </select>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn-outline" id="modal-cancel">取消</button>
                <button type="submit" form="booking-form" class="btn-primary">確認預約</button>
            </div>
        </div>
    </div>

    <!-- Day Management Modal (Admin) -->
    <div id="day-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content day-modal-content">
            <div class="modal-header">
                <h3 id="day-modal-title">日期管理</h3>
                <button class="btn-close" id="day-modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body day-modal-body">
                <div class="day-info" id="day-info"></div>
                <div class="day-beds-control" id="day-beds-control"></div>
                <div class="day-bookings-list" id="day-bookings-list"></div>
            </div>
        </div>
    </div>

    <!-- User Modal (Admin) -->
    <div id="user-modal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-modal-title">新增使用者</h3>
                <button class="btn-close" id="user-modal-close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <form id="user-form" class="modal-body">
                <div class="form-group">
                    <label>帳號</label>
                    <input type="text" id="user-username" placeholder="請輸入帳號" required>
                </div>
                <div class="form-group">
                    <label>密碼</label>
                    <input type="password" id="user-password" placeholder="請輸入密碼">
                </div>
                <div class="form-group">
                    <label>姓名</label>
                    <input type="text" id="user-display-name" placeholder="請輸入姓名" required>
                </div>
                <div class="form-group">
                    <label>角色</label>
                    <select id="user-role-select" required>
                        <option value="user">一般使用者</option>
                        <option value="pharmacist">藥師</option>
                        <option value="admin">系統管理員</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label inline-checkbox">
                        <input type="checkbox" id="user-active" checked>
                        <span class="checkmark"></span>
                        帳號啟用
                    </label>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn-outline" id="user-modal-cancel">取消</button>
                <button type="submit" form="user-form" class="btn-primary">儲存</button>
            </div>
        </div>
    </div>

    <!-- Context Menu for Calendar -->
    <div id="context-menu" class="context-menu">
        <button class="context-item" data-action="edit">✏️ 編輯預約</button>
        <button class="context-item" data-action="move">📅 移動日期</button>
        <button class="context-item delete" data-action="delete">🗑️ 刪除預約</button>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="app.js"></script>
</body>

</html>